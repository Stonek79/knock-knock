# –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ Knock-Knock

> –î–∞—Ç–∞: –§–µ–≤—Ä–∞–ª—å 2026
> –°—Ç–∞—Ç—É—Å: –í –ø—Ä–æ—Ü–µ—Å—Å–µ

---

## 1. –û–±–∑–æ—Ä

–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ 4 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º:
1. **–î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞** ‚Äî –∫–∞—Å—Ç–æ–º–Ω—ã–µ UI-–æ–±—ë—Ä—Ç–∫–∏, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ —Ç–æ–∫–µ–Ω—ã, Scale Factor
2. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** ‚Äî FSD, –ª–µ–π–∞—É—Ç—ã, –º–æ–∫–∏, cleanup
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –ø–∏—Ä–∞–º–∏–¥–∞ Unit ‚Üí Integration ‚Üí Component ‚Üí E2E
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî CSP, sanitize, crypto type safety

–ü—Ä–∏–Ω—Ü–∏–ø: **–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ**, –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è `lint + build + test`.

---

## 2. –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 2.1 –î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞

| –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª—ã | –°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å |
|----------|-------|-------------|
| Radix —Å—Ç–∏–ª–∏–∑—É—é—â–∏–µ –ø—Ä–æ–ø—Å—ã (`color`, `size`, `radius`) –≤ ~50 —Ñ–∞–π–ª–∞—Ö | features/, pages/ | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è |
| –ù–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –æ–±—ë—Ä—Ç–æ–∫ –¥–ª—è Text, Heading, Avatar, IconButton –∏ –¥—Ä. | components/ui/ | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è |
| –°–º–µ—à–µ–Ω–∏–µ Radix `Button` –∏ –Ω–∞—à–µ–≥–æ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ `Button` | ~10 —Ñ–∞–π–ª–æ–≤ | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è |
| `size="var(...)"` –ø—Ä—è–º–æ –≤ JSX-–∞—Ç—Ä–∏–±—É—Ç–∞—Ö | ~5 —Ñ–∞–π–ª–æ–≤ | üü° –°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è |
| –•–∞—Ä–¥–∫–æ–¥ HEX-—Ü–≤–µ—Ç–æ–≤ –≤ CSS-–º–æ–¥—É–ª—è—Ö | theme-selector.module.css | üü° –°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è |
| –ù–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è font-weight, text-align | index.css | üü° –°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è |

### 2.2 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

| –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª—ã | –°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å |
|----------|-------|-------------|
| `MobileHeader` ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ layout | `layouts/MobileHeader/` | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è |
| `ChatLayout` ‚Äî –ø—É—Å—Ç–æ–π `<Outlet />` | `layouts/ChatLayout/` | üü° –ú—É—Å–æ—Ä |
| `PrivateLayout` ‚Äî wrapper 100%√ó100% | `layouts/PrivateLayout/` | üü° –ú—É—Å–æ—Ä |
| `AuthLayout` ‚Äî guard-–ø–∞—Ç—Ç–µ—Ä–Ω, –Ω–µ layout | `layouts/AuthLayout/` | üü° –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ |
| `mock/client.ts` ‚Äî God Object (571 —Å—Ç—Ä–æ–∫) | `lib/mock/client.ts` | üü° –°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è |

### 2.3 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –ü—Ä–æ–±–ª–µ–º–∞ | –î–µ—Ç–∞–ª–∏ |
|----------|--------|
| –ü–æ–∫—Ä—ã—Ç–∏–µ ~20% | –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –º–æ–¥—É–ª–µ–π –Ω–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ |
| Crypto core ‚Äî 0 —Ç–µ—Å—Ç–æ–≤ | `encryption.ts`, `keys.ts`, `keystore.ts` |
| Hooks ‚Äî 0 —Ç–µ—Å—Ç–æ–≤ | `useMessages`, `useRoomKey`, `useChatList` |
| Storybook ‚Äî 1 story | –¢–æ–ª—å–∫–æ `Skeletons.stories.tsx` |

### 2.4 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å |
|----------|--------|
| –ù–µ—Ç CSP (Content-Security-Policy) | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç |
| –ù–µ—Ç sanitize —Å–æ–æ–±—â–µ–Ω–∏–π | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç |
| `as CryptoKeyPair` –∫–∞—Å—Ç–æ–≤–∞–Ω–∏—è (7 –º–µ—Å—Ç) | ‚ö†Ô∏è Web Crypto API –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ |

---

## 3. –ü–ª–∞–Ω —Ä–µ—à–µ–Ω–∏—è

### –ú–æ–¥—É–ª—å 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
- Git-–≤–µ—Ç–∫–∞ `refactor/design-system-v2`
- Snapshot baseline: `npm run build && npm run test`

### –ú–æ–¥—É–ª—å 1: –û—á–∏—Å—Ç–∫–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∞–≤–∫–∏
- –£–¥–∞–ª–∏—Ç—å `lib/utils.ts`, `lib/stores/`, `jsonwebtoken`
- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `lib/auth-errors.ts` ‚Üí `features/auth/utils/`
- –û–±–Ω–æ–≤–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ docs

### –ú–æ–¥—É–ª—å 2: FSD + –†–∞–∑–≤—è–∑–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–í –ø—Ä–æ—Ü–µ—Å—Å–µ)
- [x] –†–∞–∑–≤—è–∑–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ Sibling Imports)
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–º–µ–Ω–∞ `chat` (–†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –ø–æ–¥-–¥–æ–º–µ–Ω—ã: `room`, `message`, `list`, `creation`)
- [x] –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è God Objects: `room.ts`
- [x] –û—á–∏—Å—Ç–∫–∞ Layouts –æ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ (`SidebarContent`)
- [ ] FSD: `usePresence` ‚Üí global, `ProfileForm` ‚Üí settings
- [ ] Layouts: —É–¥–∞–ª–∏—Ç—å ChatLayout, PrivateLayout
- [ ] Layouts: MobileHeader ‚Üí —á–∏—Å—Ç–∞—è —à–∞–ø–∫–∞ + action slots
- [ ] Layouts: AuthLayout ‚Üí `guards/AuthGuard`

### –ú–æ–¥—É–ª—å 3: Mock-—Å–∏—Å—Ç–µ–º–∞
- –†–∞–∑–±–∏—Ç—å `client.ts` –Ω–∞ –º–æ–¥—É–ª–∏ –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º
- –¢–∏–ø–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã–µ —Ç–∏–ø—ã

### –ú–æ–¥—É–ª—å 4: –î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞ (–¢–ï–ö–£–©–ò–ô) ‚úÖ

#### –ë–ª–æ–∫ 0: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `index.css`
- [x] –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω—ã: `--font-weight-*`, `--font-family`
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω—ã: `--color-success-alpha`, `--color-warning-alpha`

#### –ë–ª–æ–∫ 1: UI-–æ–±—ë—Ä—Ç–∫–∏ (`components/ui/`)
–°–æ–∑–¥–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –æ–±—ë—Ä—Ç–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∏–ª–∏–∑—É—é—â–∏—Ö Radix-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–æ–ø—Å—ã |
|-----------|--------|--------|
| `Button` | ‚úÖ –ì–æ—Ç–æ–≤ | `variant`, `size` |
| `Alert` | ‚úÖ –ì–æ—Ç–æ–≤ | `variant` |
| `AppLogo` | ‚úÖ –ì–æ—Ç–æ–≤ | `size` |
| `Text` | üî≤ –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å | `variant`, `size`, `weight`, `align` |
| `Heading` | üî≤ –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å | `level`, `size` |
| `IconButton` | üî≤ –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å | `variant`, `size` |
| `Avatar` | üî≤ –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å | `size`, `name`, `src` |
| `Badge` | üî≤ –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å | `variant` |
| `Spinner` | üî≤ –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å | `size` |
| `Card` | üî≤ –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å | `variant` |
| `TextField` | üî≤ –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å | `size` |
| `TextArea` | üî≤ –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å | `size` |

#### –ë–ª–æ–∫ 2: features/auth/
- [ ] `LoginForm.tsx` ‚Äî —É–±—Ä–∞—Ç—å Radix –ø—Ä–æ–ø—Å—ã
- [ ] `PinScreen/` ‚Äî —É–±—Ä–∞—Ç—å Radix –ø—Ä–æ–ø—Å—ã

#### –ë–ª–æ–∫ 3: features/chat/ ‚Äî –¥–∏–∞–ª–æ–≥–∏ –∏ —à–∞–ø–∫–∏
- [ ] `CreateGroupDialog/`, `CreateChatDialog/`
- [ ] `RoomHeader/` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- [ ] `SettingsHeader/`

#### –ë–ª–æ–∫ 4: features/chat/ ‚Äî —Å–æ–æ–±—â–µ–Ω–∏—è
- [ ] `MessageBubble/`, `MessageActions/`, `MessageEdit/`
- [ ] `MessageInput/`, `MessageList/`
- [ ] `ChatList/`, `ChatRoom/`

#### –ë–ª–æ–∫ 5: features/contacts/
- [ ] `ContactList/`, `ContactPicker/`

#### –ë–ª–æ–∫ 6: features/settings/
- [ ] `ProfileForm/`, `AccountSettings/`, `SecuritySettings/`
- [ ] `AppearanceSettings/`, `SettingsMenu/`

#### –ë–ª–æ–∫ 7: features/admin/ + features/favorites/ + features/navigation/
- [ ] `AdminLayout/`, `AdminDashboard/`, `UserList/`
- [ ] `FavoritesList/`, `MobileHeader/`

#### –ë–ª–æ–∫ 8: pages/
- [ ] `LoginPage/`, `LandingPage/`, `FavoritesPage/`

### –ú–æ–¥—É–ª—å 5: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- `lib/security/`: CSP –º–µ—Ç–∞-—Ç–µ–≥, `sanitize.ts` (DOMPurify)
- `docs/SECURITY.md`

### –ú–æ–¥—É–ª—å 6: Unit-—Ç–µ—Å—Ç—ã
- –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞: `test/helpers/`, `test/fixtures/`
- –¢–µ—Å—Ç—ã crypto, services, stores

### –ú–æ–¥—É–ª—å 7: Integration + Component
- –¢–µ—Å—Ç—ã hooks, Storybook stories

### –ú–æ–¥—É–ª—å 8: –ù–æ–≤—ã–µ —Ñ–∏—á–∏
- `features/feedback/` ‚Äî —Ñ–æ—Ä–º–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
- Email auth (Supabase SMTP)

### –ú–æ–¥—É–ª—å 9: E2E —Ç–µ—Å—Ç—ã
- Playwright: login, chat, theme, PIN

### –ú–æ–¥—É–ª—å 10: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –û–±–Ω–æ–≤–∏—Ç—å ARCHITECTURE.md, DESIGN.md, TESTING.md
- –°–æ–∑–¥–∞—Ç—å SECURITY.md

---

## 4. –û—Ü–µ–Ω–∫–∞

| –§–∞–∑–∞ | –°—Ä–æ–∫ |
|------|------|
| –ú–æ–¥—É–ª–∏ 0-1 (–æ—á–∏—Å—Ç–∫–∞) | 0.5 –¥–Ω—è |
| –ú–æ–¥—É–ª—å 2 (FSD + layouts) | 1-1.5 –¥–Ω—è |
| –ú–æ–¥—É–ª—å 3 (mock) | 0.5 –¥–Ω—è |
| –ú–æ–¥—É–ª—å 4 (–¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞) | 2-3 –¥–Ω—è |
| –ú–æ–¥—É–ª—å 5 (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å) | 0.5 –¥–Ω—è |
| –ú–æ–¥—É–ª–∏ 6-7 (—Ç–µ—Å—Ç—ã) | 3-5 –¥–Ω–µ–π |
| –ú–æ–¥—É–ª–∏ 8-10 (—Ñ–∏—á–∏, E2E, docs) | 2-3 –¥–Ω—è |
| **–ò—Ç–æ–≥–æ** | **~12-16 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π** |
