# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ Knock-Knock

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã, —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø—Ä–∞–≤–∏–ª–∞, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –≤—Å–µ–º–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏.

---

## üèó –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1.  **Mobile First**: –í–µ—Å—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –∏ –≤–µ—Ä—Å—Ç–∞–µ—Ç—Å—è –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞. Desktop ‚Äî —ç—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (–∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è).
2.  **Offline First**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (TanStack Query) –∏ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.
3.  **Secure by Design**: E2E —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –æ–ø—Ü–∏—è, –∞ –±–∞–∑–∞. –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–∫–∏–¥–∞—é—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.
4.  **Zero Knowledge**: –°–µ—Ä–≤–µ—Ä (Supabase) —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–ª–æ–±—ã –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ. –ù–∏–∫–∞–∫–∏—Ö –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ë–î.
5.  **Web Core as Source of Truth**: –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–¥–µ—Ç—Å—è –∫–∞–∫ Web/PWA. –ù–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Android/Desktop) —è–≤–ª—è—é—Ç—Å—è –æ–±–µ—Ä—Ç–∫–∞–º–∏ (Wrappers) –Ω–∞–¥ –≤–µ–±-—è–¥—Ä–æ–º.

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –°–ª–æ–π | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ |
|------|------------|
| **Frontend** | React 19, TypeScript, Vite |
| **Routing** | TanStack Router (File-based routing) |
| **State (Server)** | TanStack Query (v5) |
| **State (Global)** | Zustand |
| **UI Kit** | Radix UI Themes (Primitive-based) |
| **Styling** | CSS Modules + Vanilla CSS (Variables) |
| **Icons** | Lucide React |
| **Backend** | Supabase (Auth, Postgres, Realtime) |
| **Crypto** | Web Crypto API (SubtleCrypto: ECDH-ES, AES-GCM) |
| **Wrappers** | Capacitor (Mobile), Tauri (Desktop) ‚Äî *Planned* |

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (Feature-Based Architecture)

–ü—Ä–æ–µ–∫—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –¥–æ–º–µ–Ω–∞–º (Features), –∞ –Ω–µ –ø–æ —Ç–∏–ø—É —Ñ–∞–π–ª–æ–≤.

```
app/src/
‚îú‚îÄ‚îÄ features/           # üü¢ –ë–ò–ó–ù–ï–°-–õ–û–ì–ò–ö–ê (–î–æ–º–µ–Ω—ã)
‚îÇ   ‚îú‚îÄ‚îÄ chat/           # –í—Å—ë, —á—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è —á–∞—Ç–∞ (—Å–ø–∏—Å–∫–∏, –æ–∫–Ω–∞, –∏–Ω–ø—É—Ç—ã)
‚îÇ   ‚îú‚îÄ‚îÄ calls/          # –ó–≤–æ–Ω–∫–∏ (UI –∏ –ª–æ–≥–∏–∫–∞ WebRTC)
‚îÇ   ‚îú‚îÄ‚îÄ auth/           # –§–æ—Ä–º—ã –≤—Ö–æ–¥–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ settings/       # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ layouts/            # üü° –°–¢–†–£–ö–¢–£–†–ê –°–¢–†–ê–ù–ò–¶
‚îÇ   ‚îú‚îÄ‚îÄ RootLayout/     # –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏ –ª–µ–π–∞—É—Ç
‚îÇ   ‚îú‚îÄ‚îÄ DesktopLayout/  # –î–≤—É—Ö–∫–æ–ª–æ–Ω–æ—á–Ω—ã–π –≤–∏–¥ (Sidebar + Content)
‚îÇ   ‚îú‚îÄ‚îÄ MobileHeader/   # –®–∞–ø–∫–∞ –¥–ª—è –º–æ–±–∏–ª–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ BottomNav/      # –ù–∞–≤–∏–≥–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ pages/              # üî¥ –¢–û–ß–ö–ò –í–•–û–î–ê (–ú–∞—Ä—à—Ä—É—Ç—ã)
‚îÇ   ‚îú‚îÄ‚îÄ LandingPage/    # –ì–ª–∞–≤–Ω–∞—è –ø—É–±–ª–∏—á–Ω–∞—è
‚îÇ   ‚îú‚îÄ‚îÄ LoginPage/      # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îî‚îÄ‚îÄ ...             # –°—Ç—Ä–∞–Ω–∏—Ü—ã —Å–æ–±–∏—Ä–∞—é—Ç features –∏ layouts
‚îÇ
‚îú‚îÄ‚îÄ components/         # ‚ö™Ô∏è UI KIT (–ì–ª—É–ø—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
‚îÇ   ‚îú‚îÄ‚îÄ ui/             # –ê—Ç–æ–º—ã: Button, AppLogo, Alert
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ lib/                # ‚ö´Ô∏è –Ø–î–†–û (Core)
‚îÇ   ‚îú‚îÄ‚îÄ constants/      # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (Runtime)
‚îÇ   ‚îú‚îÄ‚îÄ types/          # –¢–∏–ø—ã (Compile-time)
‚îÇ   ‚îú‚îÄ‚îÄ crypto/         # –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ supabase.ts     # –ö–ª–∏–µ–Ω—Ç –ë–î
‚îÇ
‚îú‚îÄ‚îÄ hooks/              # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ö—É–∫–∏ (useMediaQuery, useTheme)
‚îú‚îÄ‚îÄ stores/             # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ Zustand —Å—Ç–æ—Ä—ã (auth, theme)
‚îî‚îÄ‚îÄ locales/            # i18n JSON —Ñ–∞–π–ª—ã (RU/EN)
```

### –ü—Ä–∞–≤–∏–ª–∞ —Å–ª–æ–µ–≤:
1.  **Pages** –º–æ–≥—É—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å **Features**, **Layouts** –∏ **Components**.
2.  **Features** –º–æ–≥—É—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å **Components** –∏ **Hooks**. Features –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≤–∏—Å–µ—Ç—å –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞ (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ).
3.  **Layouts** —É–ø—Ä–∞–≤–ª—è—é—Ç —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º **Features** –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.
4.  **Lib** ‚Äî —ç—Ç–æ —è–¥—Ä–æ, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç React (–ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏).

---

## üß† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

### 1. Server State (TanStack Query) ‚Äî *–ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ*
–í—Å—ë, —á—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏–∑ –ë–î (—á–∞—Ç—ã, —Å–æ–æ–±—â–µ–Ω–∏—è, –ø—Ä–æ—Ñ–∏–ª—å), –¥–æ–ª–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ TanStack Query.
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π –∫–ª—é—á–∏ `['rooms', userId]`.
- **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è**: –ü–æ—Å–ª–µ –º—É—Ç–∞—Ü–∏–π (sendMessage) –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–π —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–≤–µ—Ä–∏.

### 2. Global Client State (Zustand)
–¢–æ–ª—å–∫–æ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã –≤—Å–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –∏ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î:
- `useAuthStore` (—Ç–µ–∫—É—â–∏–π —é–∑–µ—Ä, —Å–µ—Å—Å–∏—è).
- `useThemeStore` (—Ç–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è).
- `useCallStore` (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞).

### 3. Local State (useState)
–î–ª—è UI-—Å–æ—Å—Ç–æ—è–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (–æ—Ç–∫—Ä—ã—Ç –º–æ–¥–∞–ª–∫–∞, –∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω–ø—É—Ç–∞, hover).
–ù–µ –≤—ã–Ω–æ—Å–∏ —ç—Ç–æ –≤ global store!

---

## üìê –¢–∏–ø—ã –∏ –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã

–ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É Runtime –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∏ Compile-time —Ç–∏–ø–∞–º–∏.

### 1. –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (`lib/constants/`)
–¢–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã `as const`. –§–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å "–ª—ë–≥–∫–∏–º–∏".

```typescript
// lib/constants/common.ts
export const CHAT_TYPE = {
    PUBLIC: 'public',
    PRIVATE: 'private',
} as const;
```

### 2. –¢–∏–ø—ã (`lib/types/`)
–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –∞–ª–∏–∞—Å—ã –∏ —Ç–∏–ø—ã, –≤—ã–≤–µ–¥–µ–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Å—Ç–∞–Ω—Ç.

```typescript
// lib/types/chat.ts
import { CHAT_TYPE } from '@/lib/constants';

export type ChatType = typeof CHAT_TYPE[keyof typeof CHAT_TYPE];
```

### 3. Barrel Exports
–ö–∞–∂–¥–∞—è –ø–∞–ø–∫–∞ –≤ `lib/types` –∏ `lib/constants` –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å `index.ts` –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞:
```typescript
import { CHAT_TYPE } from '@/lib/constants';
import type { ChatType } from '@/lib/types';
```

---

## üé® UI/UX –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã

1.  **Radix First**: –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Radix Themes (`<Flex>`, `<Box>`, `<Text>`) –¥–ª—è –≤–µ—Ä—Å—Ç–∫–∏. –ù–µ –ø–∏—à–∏ `div` —Å –∫–ª–∞—Å—Å–∞–º–∏ –¥–ª—è –ª–µ–π–∞—É—Ç–∞.
2.  **CSS Modules**: –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∏–ª—å, —Å–æ–∑–¥–∞–π `Component.module.css`.
3.  **Inline Styles –ó–ê–ü–†–ï–©–ï–ù–´**: `style={{ margin: 10 }}` ‚Äî –ø–æ–¥ –∑–∞–ø—Ä–µ—Ç–æ–º.
4.  **–ò–∫–æ–Ω–∫–∏**: –¢–æ–ª—å–∫–æ `lucide-react`.

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (Security Guidelines)

1.  **Secret Keys**: –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (`cryptoKey`) **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∏–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç (–±—Ä–∞—É–∑–µ—Ä). –ù–∏–∫–∞–∫–∏—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
2.  **XSS Protection**: –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π `dangerouslySetInnerHTML`. –ù–∞—Å—Ç—Ä–æ–µ–Ω CSP (`Content-Security-Policy`).
3.  **Storage**: –ö–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `IndexedDB` (–Ω–µ LocalStorage) —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `non-extractable`.
4.  **Rate Limiting**: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –ø–æ—Å–ª–µ 5 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ (–∑–∞—â–∏—Ç–∞ –æ—Ç Brute-force).

---

## üõ° Security Testing
–ï–∂–µ–º–µ—Å—è—á–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞:
-   **XSS**: –ü–æ–ø—ã—Ç–∫–∞ –∏–Ω—ä–µ–∫—Ü–∏–∏ `<script>` –≤ –ø–æ–ª—è –≤–≤–æ–¥–∞.
-   **Brute-Force**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Å–ª–µ N –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞.
-   **Dependency Audit**: `npm audit` –¥–ª—è –ø–æ–∏—Å–∫–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π.

---

## üîÑ –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (Workflow)

1.  **–õ–∏–Ω—Ç–∏–Ω–≥**: `npm run lint` –∏ `npx tsc --noEmit` –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–∏—Ç–æ–º.
2.  **–ò–º–ø–æ—Ä—Ç—ã**: –ò—Å–ø–æ–ª—å–∑—É–π –∞–ª–∏–∞—Å `@/` (–Ω–∞–ø—Ä. `@/features/chat`). –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ (`../../`) –¥–æ–ø—É—Å—Ç–∏–º—ã —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π —Ñ–∏—á–∏.
3.  **–Ø–∑—ã–∫**: –ö–æ–¥, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –∫–æ–º–º–∏—Ç—ã ‚Äî –Ω–∞ **—Ä—É—Å—Å–∫–æ–º** –∏–ª–∏ **–∞–Ω–≥–ª–∏–π—Å–∫–æ–º** (–Ω–æ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ). –¢–µ–∫—É—â–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ RU.
