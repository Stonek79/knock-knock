# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ Knock-Knock

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã, —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø—Ä–∞–≤–∏–ª–∞, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –≤—Å–µ–º–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏.

---

## üèó –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1.  **Mobile First**: –í–µ—Å—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –∏ –≤–µ—Ä—Å—Ç–∞–µ—Ç—Å—è –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞. Desktop ‚Äî —ç—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (–∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è).
2.  **Offline First**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (TanStack Query) –∏ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.
3.  **Secure by Design**: E2E —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –æ–ø—Ü–∏—è, –∞ –±–∞–∑–∞. –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–∫–∏–¥–∞—é—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.
4.  **Zero Knowledge**: –°–µ—Ä–≤–µ—Ä (Supabase) —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–ª–æ–±—ã –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ. –ù–∏–∫–∞–∫–∏—Ö –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ë–î.
5.  **Web Core as Source of Truth**: –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–¥–µ—Ç—Å—è –∫–∞–∫ Web/PWA. –ù–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Android/Desktop) —è–≤–ª—è—é—Ç—Å—è –æ–±–µ—Ä—Ç–∫–∞–º–∏ (Wrappers) –Ω–∞–¥ –≤–µ–±-—è–¥—Ä–æ–º.

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –°–ª–æ–π | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ |
|------|------------|
| **Frontend** | React 19, TypeScript, Vite |
| **Routing** | TanStack Router (File-based routing) |
| **State (Server)** | TanStack Query (v5) |
| **State (Global)** | Zustand |
| **UI Kit** | Radix UI Themes (Primitive-based) |
| **Styling** | CSS Modules + Vanilla CSS (Variables) |
| **Icons** | Lucide React |
| **Backend** | Supabase (Auth, Postgres, Realtime) |
| **Crypto** | Web Crypto API (SubtleCrypto: ECDH-ES, AES-GCM) |
| **Wrappers** | Capacitor (Mobile), Tauri (Desktop) ‚Äî *Planned* |

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (Feature-Driven Architecture)

–ü—Ä–æ–µ–∫—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –¥–æ–º–µ–Ω–∞–º (Features), –∞ –Ω–µ –ø–æ —Ç–∏–ø—É —Ñ–∞–π–ª–æ–≤. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≥–º–∞—Ç–∏—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (Feature-Driven Architecture), –∞ –Ω–µ —Å—Ç—Ä–æ–≥–∏–π FSD, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∏–∑–ª–∏—à–Ω–µ–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏.

```
app/src/
‚îú‚îÄ‚îÄ features/           # üü¢ –ë–ò–ó–ù–ï–°-–õ–û–ì–ò–ö–ê (–î–æ–º–µ–Ω—ã)
‚îÇ   ‚îú‚îÄ‚îÄ chat/           # –°–ª–æ–∂–Ω–∞—è —Ñ–∏—á–∞. –í–Ω—É—Ç—Ä–∏ —Ä–∞–∑–±–∏—Ç–∞ –Ω–∞ sub-domains (modules/Message, modules/ChatList)
‚îÇ   ‚îú‚îÄ‚îÄ calls/          # –ó–≤–æ–Ω–∫–∏ (UI –∏ –ª–æ–≥–∏–∫–∞ WebRTC)
‚îÇ   ‚îú‚îÄ‚îÄ auth/           # –§–æ—Ä–º—ã –≤—Ö–æ–¥–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ profile/        # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é (–∫–ª—é—á–∏)
‚îÇ   ‚îî‚îÄ‚îÄ settings/       # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ layouts/            # üü° –°–¢–†–£–ö–¢–£–†–ê –°–¢–†–ê–ù–ò–¶
‚îÇ   ‚îú‚îÄ‚îÄ RootLayout/     # –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏ –ª–µ–π–∞—É—Ç
‚îÇ   ‚îú‚îÄ‚îÄ DesktopLayout/  # –î–≤—É—Ö–∫–æ–ª–æ–Ω–æ—á–Ω—ã–π –≤–∏–¥ (Sidebar + Content)
‚îÇ   ‚îú‚îÄ‚îÄ MobileHeader/   # –®–∞–ø–∫–∞ –¥–ª—è –º–æ–±–∏–ª–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ BottomNav/      # –ù–∞–≤–∏–≥–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ pages/              # üî¥ –¢–û–ß–ö–ò –í–•–û–î–ê (–ú–∞—Ä—à—Ä—É—Ç—ã)
‚îÇ   ‚îú‚îÄ‚îÄ LandingPage/    # –ì–ª–∞–≤–Ω–∞—è –ø—É–±–ª–∏—á–Ω–∞—è
‚îÇ   ‚îú‚îÄ‚îÄ LoginPage/      # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îî‚îÄ‚îÄ ...             # –°—Ç—Ä–∞–Ω–∏—Ü—ã —Å–æ–±–∏—Ä–∞—é—Ç features –∏ layouts
‚îÇ
‚îú‚îÄ‚îÄ components/         # ‚ö™Ô∏è UI KIT (–ì–ª—É–ø—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
‚îÇ   ‚îú‚îÄ‚îÄ ui/             # –ê—Ç–æ–º—ã: Button, AppLogo, Alert
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ lib/                # ‚ö´Ô∏è –Ø–î–†–û (Core)
‚îÇ   ‚îú‚îÄ‚îÄ constants/      # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (Runtime)
‚îÇ   ‚îú‚îÄ‚îÄ types/          # –¢–∏–ø—ã (Compile-time)
‚îÇ   ‚îú‚îÄ‚îÄ crypto/         # –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ supabase.ts     # –ö–ª–∏–µ–Ω—Ç –ë–î
‚îÇ
‚îú‚îÄ‚îÄ hooks/              # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ö—É–∫–∏ (useMediaQuery, useTheme)
‚îú‚îÄ‚îÄ stores/             # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ Zustand —Å—Ç–æ—Ä—ã (auth, theme)
‚îî‚îÄ‚îÄ locales/            # i18n JSON —Ñ–∞–π–ª—ã (RU/EN)
```

## –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —á–∞—Ç–æ–≤

| –¢–∏–ø | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|-----|----------|
| **–ü—É–±–ª–∏—á–Ω—ã–π DM** | `/chat/:roomId` | 1-–Ω–∞-1 —á–∞—Ç, –∏—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î |
| **–ü—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç** | `/private/:roomId` | 1-–Ω–∞-1 —ç—Ñ–µ–º–µ—Ä–Ω—ã–π —á–∞—Ç, –∏—Å—Ç–æ—Ä–∏—è —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ |
| **–ì—Ä—É–ø–ø–∞** | `/chat/:roomId` | –ì—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç, –º–Ω–æ–∂–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ |
| **DM-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä** | `/dm/:userId` | Redirect-—Ä–æ—É—Ç: –Ω–∞—Ö–æ–¥–∏—Ç/—Å–æ–∑–¥–∞—ë—Ç –∫–æ–º–Ω–∞—Ç—É –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç |

---

## –¶–µ–ª–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
routes/
‚îú‚îÄ‚îÄ __root.tsx                    # RootLayout (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π: init, ghost, dev banner)
‚îú‚îÄ‚îÄ index.tsx                     # / ‚Äî IndexPage (landing –∏–ª–∏ redirect)
‚îú‚îÄ‚îÄ login.tsx                     # /login ‚Äî LoginPage
‚îÇ
‚îú‚îÄ‚îÄ _auth.tsx                     # AuthLayout ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ _auth/
‚îÇ   ‚îú‚îÄ‚îÄ chat.tsx                  # ChatLayout ‚Äî Outlet + sidebar context
‚îÇ   ‚îú‚îÄ‚îÄ chat/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.tsx             # /chat ‚Äî ChatIndexPage
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ $roomId.tsx           # /chat/:roomId ‚Äî ChatRoomPage
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ private.tsx               # PrivateLayout ‚Äî Outlet + sidebar context
‚îÇ   ‚îú‚îÄ‚îÄ private/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.tsx             # /private ‚Äî PrivateChatPage
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ $roomId.tsx           # /private/:roomId ‚Äî PrivateRoomPage
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ dm.$userId.tsx            # /dm/:userId ‚Äî DMInitializer
‚îÇ   ‚îú‚îÄ‚îÄ contacts.tsx              # /contacts ‚Äî ContactsPage
‚îÇ   ‚îú‚îÄ‚îÄ calls.tsx                 # /calls ‚Äî CallsPage
‚îÇ   ‚îú‚îÄ‚îÄ favorites.tsx             # /favorites ‚Äî FavoritesPage
‚îÇ   ‚îú‚îÄ‚îÄ profile.tsx               # /profile ‚Äî ProfilePage
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ settings.tsx              # SettingsLayout
‚îÇ   ‚îú‚îÄ‚îÄ settings/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.tsx             # /settings ‚Äî SettingsIndexPage
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ account.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ appearance.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ privacy.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notifications.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ security.tsx
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ admin.tsx                 # AdminLayout
‚îÇ   ‚îî‚îÄ‚îÄ admin/
‚îÇ       ‚îú‚îÄ‚îÄ index.tsx             # /admin ‚Äî AdminDashboard
‚îÇ       ‚îî‚îÄ‚îÄ users.tsx             # /admin/users ‚Äî UserList
```


### –ü—Ä–∞–≤–∏–ª–∞ —Å–ª–æ–µ–≤ (Feature-Driven Architecture):
1.  **Pages** –º–æ–≥—É—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å **Features**, **Layouts** –∏ **Components**.
2.  **Features** –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É—é—Ç –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ (—Ö—É–∫–∏, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–¥-–¥–æ–º–µ–Ω–∞). –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ñ–∏—á–µ–π (–∫–∞–∫ `chat`) –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –º–æ–¥—É–ª–∏ (`modules/Message`, `modules/ChatRoom`), –≥–¥–µ –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å —Ö—Ä–∞–Ω–∏—Ç —Å–≤–æ–∏ —Ö—É–∫–∏ –∏ UI —Ä—è–¥–æ–º.
3.  **Features** –º–æ–≥—É—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å **Components** –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ **Hooks**. –§–∏—á–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≤–∏—Å–µ—Ç—å –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞ (Sibling Imports –∑–∞–ø—Ä–µ—â–µ–Ω—ã).
4.  **Layouts** —É–ø—Ä–∞–≤–ª—è—é—Ç —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º **Features** –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.
5.  **Lib** ‚Äî —ç—Ç–æ —è–¥—Ä–æ, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç React (–ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏).

---

## üß† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

### 1. Server State (TanStack Query) ‚Äî *–ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ*
–í—Å—ë, —á—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏–∑ –ë–î (—á–∞—Ç—ã, —Å–æ–æ–±—â–µ–Ω–∏—è, –ø—Ä–æ—Ñ–∏–ª—å), –¥–æ–ª–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ TanStack Query.
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π –∫–ª—é—á–∏ `['rooms', userId]`.
- **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è**: –ü–æ—Å–ª–µ –º—É—Ç–∞—Ü–∏–π (sendMessage) –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–π —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–≤–µ—Ä–∏.

### 2. Global Client State (Zustand)
–¢–æ–ª—å–∫–æ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã –≤—Å–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –∏ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î:
- `useAuthStore` (—Ç–µ–∫—É—â–∏–π —é–∑–µ—Ä, —Å–µ—Å—Å–∏—è).
- `useThemeStore` (—Ç–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è).
- `useCallStore` (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞).

### 3. Local State (useState)
–î–ª—è UI-—Å–æ—Å—Ç–æ—è–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (–æ—Ç–∫—Ä—ã—Ç –º–æ–¥–∞–ª–∫–∞, –∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω–ø—É—Ç–∞, hover).
–ù–µ –≤—ã–Ω–æ—Å–∏ —ç—Ç–æ –≤ global store!

---

## üìê –¢–∏–ø—ã –∏ –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã

–ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É Runtime –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∏ Compile-time —Ç–∏–ø–∞–º–∏.

### 1. –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (`lib/constants/`)
–¢–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã `as const`. –§–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å "–ª—ë–≥–∫–∏–º–∏". **–ò–∑–±–µ–≥–∞–π—Ç–µ "–º–∞–≥–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–æ–∫" (magic strings) –∏ —á–∏—Å–µ–ª –Ω–∞–ø—Ä—è–º—É—é –≤ –∫–æ–¥–µ.** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–Ω–æ—Å–∏—Ç–µ –ª—é–±—ã–µ —Ö–∞—Ä–¥–∫–æ–¥ –∑–Ω–∞—á–µ–Ω–∏—è (–∏–º–µ–Ω–∞ –±–∞–∫–µ—Ç–æ–≤, —Ç–∏–ø—ã MIME, —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ç.–¥.) –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã.

```typescript
// lib/constants/theme.ts
export const RADIX_THEME = {
    [DESIGN_THEME.EMERALD]: {
        ACCENT: "gold",
        GRAY: "olive",
    },
    [DESIGN_THEME.NEON]: {
        ACCENT: "teal",
        GRAY: "slate",
    },
    DEFAULT_RADIUS: "medium",
} as const;
```

### 2. –¢–∏–ø—ã (`lib/types/`)
–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –∞–ª–∏–∞—Å—ã –∏ —Ç–∏–ø—ã, –≤—ã–≤–µ–¥–µ–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Å—Ç–∞–Ω—Ç.

```typescript
// lib/types/chat.ts
import { CHAT_TYPE } from '@/lib/constants';

export type ChatType = typeof CHAT_TYPE[keyof typeof CHAT_TYPE];
```

### 3. Barrel Exports
–ö–∞–∂–¥–∞—è –ø–∞–ø–∫–∞ –≤ `lib/types` –∏ `lib/constants` –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å `index.ts` –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞:
```typescript
import { CHAT_TYPE } from '@/lib/constants';
import type { ChatType } from '@/lib/types';
```

---

## üé® UI/UX –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã

1.  **Radix Base**: –ò—Å–ø–æ–ª—å–∑—É–π –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Radix (`<Flex>`, `<Box>`, `<Text>`) –¥–ª—è –≤–µ—Ä—Å—Ç–∫–∏. –ù–µ –ø–∏—à–∏ `div` —Å –∫–ª–∞—Å—Å–∞–º–∏ –¥–ª—è –ª–µ–π–∞—É—Ç–∞.
2.  **CSS Modules**: –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∏–ª—å, —Å–æ–∑–¥–∞–π `Component.module.css`.
3.  **Inline Styles –ó–ê–ü–†–ï–©–ï–ù–´**: `style={{ margin: 10 }}` ‚Äî –ø–æ–¥ –∑–∞–ø—Ä–µ—Ç–æ–º.
4.  **–ò–∫–æ–Ω–∫–∏**: –¢–æ–ª—å–∫–æ `lucide-react`.

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç —É–≥—Ä–æ–∑ API (Security Guidelines)

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±–∞–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –≤—ã—è–≤–ª–µ–Ω–∏–∏ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–∏ –æ–±—â–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π (OWASP API Security Top 10):

1. **Broken Object Level Authorization (BOLA) & Access Control**: 
   - –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î. –í Supabase –¥–ª—è —ç—Ç–æ–≥–æ —Å—Ç—Ä–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **RLS (Row Level Security)** –ø–æ–ª–∏—Ç–∏–∫–∏.
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å —Ç–æ–ª—å–∫–æ —Ç–µ—Ö —Å—Ç—Ä–æ–∫, –≥–¥–µ –µ–≥–æ `user_id` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ `room_members`.
2. **Rate Limiting (–ó–∞—â–∏—Ç–∞ –æ—Ç DDoS –∏ Brute-Force)**:
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–∞—Å—Ç—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ/—à–ª—é–∑–µ (–Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ). –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –∫—Ä–∏—Ç–∏—á–Ω—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π).
3. **Input Validation & Injection Prevention**: 
   - –õ—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—á–∏—Ç–∞—é—Ç—Å—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–º–∏. –ò–∑–±–µ–≥–∞–π—Ç–µ `dangerouslySetInnerHTML`. 
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–∏–ø–∏–∑–∞—Ü–∏—é (Zod/TypeScript) –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ –ë–î/–æ—Ç—Ä–∏—Å–æ–≤–∫–æ–π. 
   - Supabase PostgREST –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π, –Ω–æ RPC-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –ø–∏—Å–∞—Ç—å—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
4. **Data Exposure (–ò–∑–±—ã—Ç–æ—á–Ω–æ–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö)**: 
   - –í –∑–∞–ø—Ä–æ—Å–∞—Ö `supabase.from().select(...)` –≤—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ç–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ –≤–º–µ—Å—Ç–æ `*`. –ù–∏–∫–∞–∫–∏–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ö–µ—à–∏, –∫–ª—é—á–∏) –Ω–µ –¥–æ–ª–∂–Ω—ã "—É—Ç–µ–∫–∞—Ç—å" –Ω–∞ –∫–ª–∏–µ–Ω—Ç –¥–∞–∂–µ —Ç—Ä–∞–Ω–∑–∏—Ç–æ–º.
5. **Security Headers & –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç**: 
   - **HTTPS Everywhere**: –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –∏ API –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ TLS.
   - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–∫–∏ `Content-Security-Policy (CSP)`, `X-Content-Type-Options`, `X-Frame-Options` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç XSS –∏ Clickjacking.
6. **E2E –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è (–û—Å–Ω–æ–≤–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏)**: 
   - Secret Keys: –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (`cryptoKey`) **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∏–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç (–±—Ä–∞—É–∑–µ—Ä). 
   - Storage: –ö–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `IndexedDB` (–Ω–µ LocalStorage) —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `non-extractable`.

---

## üõ° Security Testing
–†–µ–≥—É–ª—è—Ä–Ω–æ (–ø–µ—Ä–µ–¥ –∫—Ä—É–ø–Ω—ã–º–∏ —Ä–µ–ª–∏–∑–∞–º–∏) –ø—Ä–æ–≤–æ–¥–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞:
-   **XSS & Validation**: –ü–æ–ø—ã—Ç–∫–∞ –∏–Ω—ä–µ–∫—Ü–∏–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤, XSS payload-—Ç–µ–∫—Å—Ç–æ–≤ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Ñ–æ—Ä–º—ã –ø—Ä–æ—Ñ–∏–ª—è.
-   **BOLA Bypass**: –ü–æ–ø—ã—Ç–∫–∞ –ø—Ä–æ—á–∏—Ç–∞—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å —á—É–∂–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –ø—Ä—è–º–æ–π –ø–æ–¥–º–µ–Ω—ã `message_id` –∏–ª–∏ `room_id` –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ Supabase.
-   **Brute-Force**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Å–ª–µ N –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ –∏ –ª–∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–ø–∞–º-—Å–æ–æ–±—â–µ–Ω–∏–π.
-   **Dependency Audit**: –ê–Ω–∞–ª–∏–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ Serverless-—Ñ—É–Ω–∫—Ü–∏–π `npm audit` –Ω–∞ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (CVE).

---

## üîÑ –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (Workflow)

1.  **–õ–∏–Ω—Ç–∏–Ω–≥**: `npm run lint` –∏ `npx tsc --noEmit` –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–∏—Ç–æ–º.
2.  **–ò–º–ø–æ—Ä—Ç—ã**: –ò—Å–ø–æ–ª—å–∑—É–π –∞–ª–∏–∞—Å `@/` (–Ω–∞–ø—Ä. `@/features/chat`). –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ (`../../`) –¥–æ–ø—É—Å—Ç–∏–º—ã —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π —Ñ–∏—á–∏.
3.  **–Ø–∑—ã–∫**: –ö–æ–¥, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –∫–æ–º–º–∏—Ç—ã ‚Äî –Ω–∞ **—Ä—É—Å—Å–∫–æ–º** –∏–ª–∏ **–∞–Ω–≥–ª–∏–π—Å–∫–æ–º** (–Ω–æ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ). –¢–µ–∫—É—â–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ RU.
